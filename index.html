<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººæ¯æ—¥å¤ç›˜å·¥å…·</title>
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;font-family: 'Microsoft YaHei', sans-serif;}
        body {background-color: #f9fbfb;padding: 16px;color: #2d3748;min-height: 100vh;display: flex;flex-direction: column;}
        .header {text-align: center;margin-bottom: 16px;padding-bottom: 12px;border-bottom: 0.5px solid #eee;white-space: nowrap;}
        .header h1 {font-size: 20px;color: #4a5568;font-weight: 600;}
        .auto-save-tip{font-size:12px;color:#4aae9b;margin-top:6px;display:none;}
        .container {max-width: 1200px;margin: 0 auto;display: grid;grid-template-columns: repeat(2,1fr);grid-template-rows: repeat(2,1fr);gap:16px;width:100%;flex:1;}
        .card {border-radius:12px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.05);display:flex;flex-direction:column;height:100%;border:0.5px solid #f0f0f0;}
        .card-header {display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;white-space:nowrap;}
        .card-title {display:flex;align-items:center;gap:8px;font-size:16px;font-weight:600;}
        
        .card-work .card-title{color:#4aae9b;}
        .card-work .card-title svg{fill:#4aae9b;}
        .card-work [contenteditable]{background:#fff;border-color:#d5ece9;}
        .card-work [contenteditable]:focus{border-color:#4aae9b;box-shadow:0 0 0 3px rgba(74,174,155,0.1);}
        .card-work .btn-img{color:#4aae9b;background:#f5fcfb;}

        .card-plan .card-title{color:#d4a76a;}
        .card-plan .card-title svg{fill:#d4a76a;}
        .card-plan [contenteditable]{background:#fff;border-color:#f5e6c8;}
        .card-plan [contenteditable]:focus{border-color:#d4a76a;box-shadow:0 0 0 3px rgba(212,167,106,0.1);}
        .card-plan .btn-img{color:#d4a76a;background:#fef9e7;}

        .card-reflection .card-title{color:#9d8ed9;}
        .card-reflection .card-title svg{fill:#9d8ed9;}
        .card-reflection [contenteditable]{background:#fff;border-color:#e6e1f5;}
        .card-reflection [contenteditable]:focus{border-color:#9d8ed9;box-shadow:0 0 0 3px rgba(157,142,217,0.1);}
        .card-reflection .btn-img{color:#9d8ed9;background:#fcfaff;}

        .card-blessing .card-title{color:#e899a8;}
        .card-blessing .card-title svg{fill:#e899a8;}
        .card-blessing [contenteditable]{background:#fff;border-color:#fde5e9;}
        .card-blessing [contenteditable]:focus{border-color:#e899a8;box-shadow:0 0 0 3px rgba(232,153,168,0.1);}
        .card-blessing .btn-img{color:#e899a8;background:#fff5f7;}

        .btn-img{padding:4px 8px;border:none;border-radius:4px;cursor:pointer;font-size:11px;display:flex;align-items:center;gap:4px;transition:all 0.3s ease;}
        .content{flex:1;display:flex;}
        [contenteditable]{width:100%;height:100%;border-radius:8px;padding:12px;font-size:14px;line-height:1.6;border:0.5px solid #eee;outline:none;overflow-y:auto;}
        [contenteditable]:empty:before{content:attr(placeholder);color:#a0aec0;pointer-events:none;display:block;}
        [contenteditable] img{max-width:100px;max-height:100px;vertical-align:middle;margin:0 4px;}

        .controls{width:100%;max-width:1200px;margin:16px auto 0;display:flex;justify-content:space-between;align-items:center;padding:0 16px;flex-wrap:wrap;row-gap:10px;}
        .history-select,.summary-type{padding:6px 10px;border:0.5px solid #f0f0f0;border-radius:6px;font-size:12px;background:#fff;cursor:pointer;}
        .search-box{padding:6px 10px;border:0.5px solid #f0f0f0;border-radius:6px;font-size:12px;flex:1 0 150px;margin:0 10px;}
        .btn-group{display:flex;gap:8px;}
        .btn{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:4px;transition:all 0.3s ease;font-weight:500;}
        .btn-danger{background:#e57373;color:#fff;}
        .btn-search{background:#f0932b;color:#fff;}
        .btn-summary{background:#2196f3;color:#fff;}
        .btn-export{background:#9c27b0;color:#fff;}
        .btn-import{background:#009688;color:#fff;}

        .search-modal,.summary-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;z-index:999;}
        .modal-content{background:#fff;border-radius:8px;padding:20px;width:90%;max-width:600px;max-height:80%;overflow-y:auto;}
        .result-item{margin-bottom:15px;padding:10px;border:0.5px solid #eee;border-radius:4px;}
        .result-date{font-weight:600;color:#4aae9b;}
        .summary-title{font-size:18px;font-weight:600;color:#4a5568;text-align:center;margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid #eee;}
        .summary-section h3{font-size:16px;color:#4aae9b;margin-bottom:8px;}
        .close-modal{margin-top:20px;padding:6px 15px;border:none;border-radius:4px;background:#4aae9b;color:#fff;cursor:pointer;}

        @media (max-width:768px){
            .container{grid-template-columns:repeat(2,1fr);}
            .header h1{font-size:16px;}
            .controls{gap:4px;font-size:10px;}
            .btn{padding:4px 8px;font-size:10px;}
            .history-select,.summary-type,.search-box{flex:1 0 120px;margin:4px 0;font-size:10px;padding:4px 8px;}
            .btn-group{flex:1 0 180px;justify-content:flex-end;}
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 id="today-title"></h1>
        <div class="auto-save-tip" id="auto-save-tip">âœ… å†…å®¹å·²è‡ªåŠ¨ä¿å­˜</div>
    </div>

    <div class="container">
        <div class="card card-work">
            <div class="card-header">
                <div class="card-title"><svg viewBox="0 0 24 24" width="18" height="18"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>ä»Šæ—¥å·¥ä½œ</div>
                <button class="btn-img" onclick="uploadImgToText('work-today')">ğŸ“· ä¼ å›¾</button>
            </div>
            <div class="content"><div id="work-today" placeholder="è®°å½•ä»Šæ—¥å®Œæˆçš„å·¥ä½œå†…å®¹..." contenteditable="true"></div></div>
        </div>
        <div class="card card-plan">
            <div class="card-header">
                <div class="card-title"><svg viewBox="0 0 24 24" width="18" height="18"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>æ˜æ—¥æ‰“ç®—</div>
                <button class="btn-img" onclick="uploadImgToText('plan-tomorrow')">ğŸ“· ä¼ å›¾</button>
            </div>
            <div class="content"><div id="plan-tomorrow" placeholder="è§„åˆ’æ˜æ—¥è¦åšçš„äº‹é¡¹..." contenteditable="true"></div></div>
        </div>
        <div class="card card-reflection">
            <div class="card-header">
                <div class="card-title"><svg viewBox="0 0 24 24" width="18" height="18"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>ä»Šæ—¥åæ€</div>
                <button class="btn-img" onclick="uploadImgToText('reflection-today')">ğŸ“· ä¼ å›¾</button>
            </div>
            <div class="content"><div id="reflection-today" placeholder="åæ€ä»Šæ—¥çš„ä¸è¶³ä¸æ”¶è·..." contenteditable="true"></div></div>
        </div>
        <div class="card card-blessing">
            <div class="card-header">
                <div class="card-title"><svg viewBox="0 0 24 24" width="18" height="18"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>ä»Šæ—¥å°ç¡®å¹¸</div>
                <button class="btn-img" onclick="uploadImgToText('blessing-today')">ğŸ“· ä¼ å›¾</button>
            </div>
            <div class="content"><div id="blessing-today" placeholder="è®°å½•ä»Šæ—¥çš„å°ç¾å¥½ç¬é—´..." contenteditable="true"></div></div>
        </div>
    </div>

    <div class="controls">
        <select id="history-date" class="history-select" onchange="loadHistory()"></select>
        <input type="text" class="search-box" id="search-input" placeholder="è¾“å…¥å…³é”®è¯æœç´¢å¤ç›˜è®°å½•...">
        <div class="summary-setting">
            <select class="summary-type" id="summary-type">
                <option value="week">æŒ‰å‘¨æ±‡æ€»</option>
                <option value="month">æŒ‰æœˆæ±‡æ€»</option>
            </select>
        </div>
        <div class="btn-group">
            <button class="btn btn-export" onclick="exportData()">ğŸ“¤ å¯¼å‡º</button>
            <button class="btn btn-import" onclick="importData()">ğŸ“¥ å¯¼å…¥</button>
            <button class="btn btn-search" onclick="searchRecords()">ğŸ” æœç´¢</button>
            <button class="btn btn-danger" onclick="deleteHistory()">ğŸ—‘ï¸ åˆ é™¤</button>
            <button class="btn btn-summary" onclick="generateSummary()">ğŸ“Š æ±‡æ€»</button>
        </div>
    </div>

    <div class="search-modal" id="search-modal">
        <div class="modal-content">
            <h3 style="margin-bottom:15px;color:#4aae9b;">æœç´¢ç»“æœ</h3>
            <div id="result-list"></div>
            <button class="close-modal" onclick="closeModal('search-modal')">å…³é—­</button>
        </div>
    </div>
    <div class="summary-modal" id="summary-modal">
        <div class="modal-content">
            <h2 class="summary-title" id="summary-title"></h2>
            <div id="summary-content"></div>
            <button class="close-modal" onclick="closeModal('summary-modal')">å…³é—­</button>
        </div>
    </div>

    <script>
        let currentDate = getToday();
        let autoSaveTimer = null;

        function getToday() {return new Date().toISOString().split('T')[0];}
        function getYesterday() {const d=new Date();d.setDate(d.getDate()-1);return d.toISOString().split('T')[0];}
        function setHeaderTitle() {document.getElementById('today-title').innerText = `${getToday()} æ¯æ—¥å¤ç›˜`;}

        // è‡ªåŠ¨åŒæ­¥æ˜¨æ—¥è®¡åˆ’â†’ä»Šæ—¥å·¥ä½œ
        function autoSyncPlanToWork() {
            const today=getToday(),yest=getYesterday(),history=JSON.parse(localStorage.getItem('review-history')||'{}');
            if(!history[today] && history[yest]?.plan.text) document.getElementById('work-today').innerHTML=history[yest].plan.text;
        }

        // ä¼ å›¾åŠŸèƒ½
        function uploadImgToText(id) {
            const inp=document.createElement('input');inp.type='file';inp.accept='image/*';
            inp.onchange=e=>{
                const file=e.target.files[0];if(!file)return;
                const reader=new FileReader();reader.onload=ev=>{
                    const img=document.createElement('img');img.src=ev.target.result;img.style.maxWidth='100px';img.style.maxHeight='100px';
                    const box=document.getElementById(id),sel=window.getSelection(),rng=sel.getRangeAt(0);
                    rng.deleteContents();rng.insertNode(img);rng.setStartAfter(img);sel.removeAllRanges();sel.addRange(rng);
                };reader.readAsDataURL(file);
            };inp.click();
        }

        // è‡ªåŠ¨ä¿å­˜æ ¸å¿ƒ
        function saveCore() {
            const today=getToday(),getContent=id=>document.getElementById(id).innerHTML;
            const data={date:today,work:{text:getContent('work-today')},plan:{text:getContent('plan-tomorrow')},reflection:{text:getContent('reflection-today')},blessing:{text:getContent('blessing-today')}};
            const history=JSON.parse(localStorage.getItem('review-history')||'{}');history[today]=data;
            localStorage.setItem('review-history',JSON.stringify(history));updateHistorySelect();showAutoSaveTip();
        }

        function showAutoSaveTip(){const t=document.getElementById('auto-save-tip');t.style.display='block';setTimeout(()=>t.style.display='none',1500);}
        function initAutoSave(){['work-today','plan-tomorrow','reflection-today','blessing-today'].forEach(id=>{document.getElementById(id).addEventListener('input',()=>{clearTimeout(autoSaveTimer);autoSaveTimer=setTimeout(saveCore,1000);});});}

        // å†å²è®°å½•ç›¸å…³
        function updateHistorySelect(){const history=JSON.parse(localStorage.getItem('review-history')||'{}'),dates=Object.keys(history).sort().reverse(),s=document.getElementById('history-date');s.innerHTML='<option value="">æŸ¥çœ‹å¾€æ—¥è®°å½•</option>';dates.forEach(d=>{const o=document.createElement('option');o.value=d;o.textContent=d;s.appendChild(o);});}
        function loadHistory(){const d=document.getElementById('history-date').value;if(!d)return;const h=JSON.parse(localStorage.getItem('review-history')||'{}'),data=h[d];if(data){document.getElementById('work-today').innerHTML=data.work.text;document.getElementById('plan-tomorrow').innerHTML=data.plan.text;document.getElementById('reflection-today').innerHTML=data.reflection.text;document.getElementById('blessing-today').innerHTML=data.blessing.text;}}
        function deleteHistory(){const d=document.getElementById('history-date').value;if(!d){alert('é€‰è¦åˆ é™¤çš„æ—¥æœŸ');return;}if(confirm(`åˆ ${d}è®°å½•ï¼Ÿ`)){const h=JSON.parse(localStorage.getItem('review-history')||'{}');delete h[d];localStorage.setItem('review-history',JSON.stringify(h));updateHistorySelect();['work-today','plan-tomorrow','reflection-today','blessing-today'].forEach(id=>document.getElementById(id).innerHTML='');alert('åˆ é™¤æˆåŠŸ');}}

        // è·¨æ—¥è‡ªåŠ¨ä¿å­˜
        function checkDateChange(){const nd=getToday();if(nd!==currentDate){saveCore();currentDate=nd;setHeaderTitle();autoSyncPlanToWork();updateHistorySelect();['work-today','plan-tomorrow','reflection-today','blessing-today'].forEach(id=>document.getElementById(id).innerHTML='');alert('è‡ªåŠ¨ä¿å­˜æ˜¨æ—¥ï¼Œåˆ‡æ¢ä»Šæ—¥å¤ç›˜');}}

        // æœç´¢+æ±‡æ€»+å¼¹çª—
        function searchRecords(){const k=document.getElementById('search-input').value.trim().toLowerCase();if(!k){alert('è¾“å…³é”®è¯');return;}const h=JSON.parse(localStorage.getItem('review-history')||'{}'),rl=document.getElementById('result-list');rl.innerHTML='';let has=false;for(const [d,r] of Object.entries(h)){const wt=r.work.text.toLowerCase(),pt=r.plan.text.toLowerCase(),rt=r.reflection.text.toLowerCase(),bt=r.blessing.text.toLowerCase();if(wt.includes(k)||pt.includes(k)||rt.includes(k)||bt.includes(k)){has=true;const st=html=>html.replace(/<img[^>]*>/g,'[å›¾ç‰‡]').replace(/<[^>]*>/g,'');rl.innerHTML+=`<div class="result-item"><div class="result-date">æ—¥æœŸï¼š${d}</div><div class="result-content"><strong>å·¥ä½œï¼š</strong>${st(r.work.text)||'æ— '}</div><div class="result-content"><strong>è®¡åˆ’ï¼š</strong>${st(r.plan.text)||'æ— '}</div><div class="result-content"><strong>åæ€ï¼š</strong>${st(r.reflection.text)||'æ— '}</div><div class="result-content"><strong>å°ç¡®å¹¸ï¼š</strong>${st(r.blessing.text)||'æ— '}</div></div>`;}}if(!has)rl.innerHTML='<div style="text-align:center;color:#999;">æ— åŒ¹é…</div>';document.getElementById('search-modal').style.display='flex';}
        function closeModal(id){document.getElementById(id).style.display='none';}
        function formatDate(d){return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getDate().toString().padStart(2,'0')}`;}
        function generateSummary(){const h=JSON.parse(localStorage.getItem('review-history')||'{}');if(!Object.keys(h).length){alert('æ— è®°å½•');return;}const t=document.getElementById('summary-type').value,td=new Date();let fr=[],st='';if(t==='week'){const ws=new Date(td);ws.setDate(td.getDate()-td.getDay()+1);ws.setHours(0,0,0,0);const we=new Date(ws);we.setDate(ws.getDate()+6);st=`${formatDate(ws)}-${formatDate(we)} å‘¨æ±‡æ€»`;fr=Object.values(h).filter(r=>{const dd=new Date(r.date);return dd>=ws&&dd<=we;});}else{const ms=new Date(td.getFullYear(),td.getMonth(),1);const me=new Date(td.getFullYear(),td.getMonth()+1,0);st=`${td.getFullYear()}å¹´${td.getMonth()+1}æœˆ æœˆæ±‡æ€»`;fr=Object.values(h).filter(r=>{const dd=new Date(r.date);return dd>=ms&&dd<=me;});}if(!fr.length){alert('å½“å‰å‘¨æœŸæ— è®°å½•');return;}const stt=html=>html.replace(/<img[^>]*>/g,'[å›¾ç‰‡]').replace(/<[^>]*>/g,'');const ws=fr.map(r=>stt(r.work.text)).filter(x=>x).join('ï¼›'),ps=fr.map(r=>stt(r.plan.text)).filter(x=>x).join('ï¼›'),rs=fr.map(r=>stt(r.reflection.text)).filter(x=>x).join('ï¼›'),bs=fr.map(r=>stt(r.blessing.text)).filter(x=>x).join('ï¼›');document.getElementById('summary-title').innerText=st;document.getElementById('summary-content').innerHTML=`
            <div class="summary-section"><h3>å·¥ä½œå†…å®¹</h3><p>${ws||'æ— è®°å½•'}</p></div>
            <div class="summary-section"><h3>è®¡åˆ’å®‰æ’</h3><p>${ps||'æ— è®°å½•'}</p></div>
            <div class="summary-section"><h3>åæ€æ€»ç»“</h3><p>${rs||'æ— è®°å½•'}</p></div>
            <div class="summary-section"><h3>å°ç¡®å¹¸é›†é”¦</h3><p>${bs||'æ— è®°å½•'}</p></div>
            <div class="summary-section"><h3>ç»Ÿè®¡</h3><p>å¤ç›˜${fr.length}æ¡</p></div>
        `;document.getElementById('summary-modal').style.display='flex';}

        // å¯¼å‡ºï¼ˆä¿®å¤ç‰ˆï¼Œå¿…æˆåŠŸï¼‰+ å¯¼å…¥
        function exportData() {
            const data=localStorage.getItem('review-history');
            if(!data){alert('æ— è®°å½•å¯å¯¼å‡º');return;}
            const a=document.createElement('a');
            a.href=URL.createObjectURL(new Blob([data],{type:'application/json'}));
            a.download=`å¤ç›˜è®°å½•_${getToday()}.json`;
            a.click();
            URL.revokeObjectURL(a.href);
            alert('å¯¼å‡ºæˆåŠŸâœ… å»æµè§ˆå™¨ä¸‹è½½æ æŸ¥çœ‹');
        }
        function importData(){const inp=document.createElement('input');inp.type='file';inp.accept='.json';inp.onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{JSON.parse(r.result);localStorage.setItem('review-history',r.result);updateHistorySelect();loadTodayRecord();alert('å¯¼å…¥æˆåŠŸ');}catch(err){alert('æ–‡ä»¶æ ¼å¼é”™');}};r.readAsText(f);};inp.click();}

        // åŠ è½½ä»Šæ—¥è®°å½•
        function loadTodayRecord(){const t=getToday(),h=JSON.parse(localStorage.getItem('review-history')||'{}');if(h[t]){document.getElementById('work-today').innerHTML=h[t].work.text;document.getElementById('plan-tomorrow').innerHTML=h[t].plan.text;document.getElementById('reflection-today').innerHTML=h[t].reflection.text;document.getElementById('blessing-today').innerHTML=h[t].blessing.text;}else{['work-today','plan-tomorrow','reflection-today','blessing-today'].forEach(id=>document.getElementById(id).innerHTML='');autoSyncPlanToWork();}}

        // åˆå§‹åŒ–
        window.onload=function(){setHeaderTitle();updateHistorySelect();loadTodayRecord();initAutoSave();setInterval(checkDateChange,10000);};
    </script>
</body>
</html>
